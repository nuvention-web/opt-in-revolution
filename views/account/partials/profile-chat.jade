extends ../../layout

block content
      b
        | Relevant Job Experience: 
      |#{jobApp.relevantJobExperience}
      br
      b
        | Project Approach: 
      |#{jobApp.projectApproach}
      #messagesDiv
      -console.log(jobApp);
      -console.log(user);
      if user.userType == 'mom'
        input#nameInput(type='hidden', placeholder='Name', value='#{user.profile.name}')
        -console.log("Monkey poo");
      else
        input#nameInput(type='hidden', placeholder='Name', value='#{user.company.companyName}')
      input#messageInput(type='text', placeholder='Message')

      script(type='text/javascript').
        var myDataRef = new Firebase('https://athenahire.firebaseio.com/#{jobApp.id}');
        $('#messageInput').keypress(function (e) {
          if (e.keyCode == 13) {
            var name = $('#nameInput').val();
            var text = $('#messageInput').val();
            myDataRef.push({name: name, text: text});
            $('#messageInput').val('');
          }
        });

        myDataRef.on('child_added', function(snapshot) {
          var message = snapshot.val();
          displayChatMessage(message.name, message.text);
        });

        function displayChatMessage(name, text) {
          $('<div/>').text(text).prepend($('<em/>').text(name+': ')).appendTo($('#messagesDiv'));
          $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
        };