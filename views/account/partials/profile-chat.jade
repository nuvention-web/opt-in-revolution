div(id='#{jobAppWithChat.id}')
if user.userType == "mom"
	input#nameInput(type='hidden', placeholder='Name', value='#{user.profile.name}')
else
	input#nameInput(type='hidden', placeholder='Name', value='#{user.company.companyName}')

input(type='text', placeholder='Message', id="messageInput-#{jobAppWithChat.id}")

script(type='text/javascript').
	$("#view-message-#{jobAppWithChat.id}").on("click", function() {
		var jobID = '#{jobAppWithChat.id}';
		$('#'+jobID).empty();
		var myDataRef = new Firebase('https://athenahire.firebaseio.com/#{jobAppWithChat.id}');
		var jobAppWithChatID = '#{jobAppWithChat.id}';
		$('#messageInput-' + jobAppWithChatID).unbind();
		$('#messageInput-' + jobAppWithChatID).keypress(function (e) {
			if (e.keyCode == 13) {
				var name = $('#nameInput').val();
				var text = $('#messageInput-' + jobAppWithChatID).val();
				if (text!='') {
					myDataRef.push({name: name, text: text});
					$('#messageInput-' + jobAppWithChatID).val('');
				}
			}
		});

		myDataRef.off('child_added');
		myDataRef.on('child_added', function(snapshot) {
			var message = snapshot.val();
			displayChatMessage(message.name, message.text);
		});

		function displayChatMessage(name, text) {
			var identifier = jobAppWithChatID;
			$('<div/>').text(text).prepend($('<em/>').text(name+': ')).appendTo($('#'+identifier));
			$('#'+identifier)[0].scrollTop = $('#'+identifier)[0].scrollHeight;
		};
	});